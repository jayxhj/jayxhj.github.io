<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>徐豪杰写字的地方</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="徐豪杰写字的地方">
<meta property="og:url" content="http://blog.jayxhj.com/index.html">
<meta property="og:site_name" content="徐豪杰写字的地方">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="徐豪杰写字的地方">
<meta name="twitter:description">
<meta name="twitter:creator" content="@jayxhj">
  
    <link rel="alternate" href="/atom.xml" title="徐豪杰写字的地方" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <!--<link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="author" href="/humans.txt" />
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27843739-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?762045bf95459c1fd6be1a6889224746";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">徐豪杰写字的地方</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">历史文章</a>
        
          <a class="main-nav-link" href="https://github.com/jayxhj">GitHub</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.jayxhj.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-post-array-data-in-php-curl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/post-array-data-in-php-curl/" class="article-date">
  <time datetime="2016-06-03T02:42:03.000Z" itemprop="datePublished">2016-06-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/post-array-data-in-php-curl/">PHP 发起 curl POST 请求时传递数组</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 使用 PHP 的 curl 可以发起 HTTP 外部请求，但是发起 POST 请求时，是无法直接传递数组的，从 curl 层面来说，也没有所谓的数组的概念，而更加通用也更合理的传递数据的格式其实是键值对（key value pair）。</p>
<p> 那么，我们先得知道，为什么要传递数组。</p>
<p>HTTP 协议规定了 HTTP 请求的三个部分：状态行、请求头、消息主体。消息主体实际上是没有规定格式的。平常主要用到的几个请求头 Content-Type 为 </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">application/x-www-form-urlencoded</span><br><span class="line">multipart/form-data</span><br><span class="line">application/json</span><br><span class="line">text/xml</span><br></pre></td></tr></table></figure>
<p> 所以问题的答案很明白了，传递什么样的数据类型得看需要发送什么样的请求。</p>
<p> 一个典型的 curl POST 请求是下面这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --data <span class="string">'params[]=check1&amp;params[]=check2'</span> <span class="string">'http://jayxhj.com/test/curl.php'</span></span><br><span class="line"></span><br><span class="line">gsg</span><br></pre></td></tr></table></figure>
<p> 上面的请求将发送一个 Content-Type 为 application/x-www-form-urlencoded 的请求，请求的 body 为 <code>params[]=check1&amp;params[]=check2</code> ，在服务端，只需使用 <code>$_POST</code> 即可获取。</p>
<p> 那么回到 curl ，我们只需设置 option 为 <strong>CURLOPT_POSTFIELDS</strong> 的 VALUE 为 key/value pair ，即可将数组以字符串的形式传递至服务端，并直接由 <code>$_POST</code> 获取。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="variable">$curl</span> = curl_init();</span><br><span class="line"></span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_URL, <span class="string">'http://jayxhj.com/test/curl.php'</span>);</span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$array</span> = [</span><br><span class="line">    <span class="string">'jayxhj'</span>,</span><br><span class="line">    <span class="string">'pt'</span></span><br><span class="line">];</span><br><span class="line"><span class="variable">$str</span>   = http_build_query(<span class="variable">$array</span>);</span><br><span class="line"></span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_POSTFIELDS, <span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$data</span> = curl_exec(<span class="variable">$curl</span>);</span><br><span class="line"></span><br><span class="line">curl_close(<span class="variable">$curl</span>);</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>
<p>sfgs</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/06/post-array-data-in-php-curl/" data-id="ciozl52aj0020896vfpqgirri" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/06/post-array-data-in-php-curl/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/curl/">curl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tips/">tips</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-jayxhjs-chrome-extensions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/jayxhjs-chrome-extensions/" class="article-date">
  <time datetime="2016-05-26T08:27:35.000Z" itemprop="datePublished">2016-05-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/jayxhjs-chrome-extensions/">常用 Chrome 扩展介绍及使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Chrome 浏览器和 Firefox 浏览器为何大受欢迎，其中一个重要原因就是因为有数量巨大的扩展库，而 360 之类的浏览器内核也是基于 Chromium 内核和 IE 内核，因为这些扩展，可以让应用（浏览器就是应用）的功能变得无比丰富和强大。</p>
<p>这篇文章会列举本人平常使用的插件，并介绍常用的用法，但由于扩展使用的主观性太强，每个人都有不同的偏好，所以此篇会把重点放在扩展的使用上，并会不定时更新。扩展排名不分先后。</p>
<p>每个扩展介绍会包含其简要介绍，下载地址及基本用法，默认给出的是 Chrome webstore 的下载地址，如果有托管在 GitHub 会给出其托管地址。</p>
<h2 id="Avatars-for-Github"><a href="#Avatars-for-Github" class="headerlink" title="Avatars for Github"></a>Avatars for Github</h2><p>一句话介绍：在 GitHub feed 页展示你关注人的头像。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/avatars-for-github/pgjmdbklnfklcjfbonjfkdhaonlfogbb" target="_blank" rel="external">https://chrome.google.com/webstore/detail/avatars-for-github/pgjmdbklnfklcjfbonjfkdhaonlfogbb</a></p>
<p>开发者网站：<a href="https://github.com/anasnakawa/chrome-github-avatars" target="_blank" rel="external">https://github.com/anasnakawa/chrome-github-avatars</a></p>
<p><img src="http://img.jayxhj.com/GitHub-feed-before.png" alt="GitHub-feed-before"></p>
<p><img src="http://img.jayxhj.com/GitHub-feed-before.png" alt="GitHub-feed-after"></p>
<h2 id="Axure-RP-Extension-for-Chrome"><a href="#Axure-RP-Extension-for-Chrome" class="headerlink" title="Axure RP Extension for Chrome"></a>Axure RP Extension for Chrome</h2><p>一句话介绍：web 版的 Axure 客户端。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/dogkpdfcklifaemcdfbildhcofnopogp" target="_blank" rel="external">https://chrome.google.com/webstore/detail/dogkpdfcklifaemcdfbildhcofnopogp</a></p>
<p>开发者网站：<a href="http://www.axure.com/" target="_blank" rel="external">http://www.axure.com/</a></p>
<p>使用：安装此插件后，即可在不安装 Axure 下的情况下，打开原型，直接在浏览器中运行。</p>
<h2 id="Chrome-Sniffer-Plus"><a href="#Chrome-Sniffer-Plus" class="headerlink" title="Chrome Sniffer Plus"></a>Chrome Sniffer Plus</h2><p>一句话介绍：网页下的类库探测器。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/fhhdlnnepfjhlhilgmeepgkhjmhhhjkh" target="_blank" rel="external">https://chrome.google.com/webstore/detail/fhhdlnnepfjhlhilgmeepgkhjmhhhjkh</a></p>
<p>开发者网站：<a href="http://justjavac.com/" target="_blank" rel="external">http://justjavac.com/</a></p>
<p>使用：探测当前网页正在使用的开源软件或者 JS 类库。其实一个网站或者应用，技术栈一般会涉及到很多的技术，这个扩展可以检测一些基本的开源类库，作为日常的探测够用了。</p>
<h2 id="hosts 文件管理工具"><a href="#hosts 文件管理工具" class="headerlink" title="hosts 文件管理工具"></a>hosts 文件管理工具 </h2><p> 一句话介绍：host 管理及切换工具。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/kpfmckjjpabojdhlncnccfhkfhbmnjfi" target="_blank" rel="external">https://chrome.google.com/webstore/detail/kpfmckjjpabojdhlncnccfhkfhbmnjfi</a></p>
<p>开发者网站：<a href="https://github.com/gbk/chrome-hosts-manager" target="_blank" rel="external">https://github.com/gbk/chrome-hosts-manager</a></p>
<p>使用：主要用来进行 ip 与 host 之间的绑定，另外可以对域名 ip 进行分组，非常适合用来进行切换环境。另外一个主要功能就是显示当前 ip ，在没有挂代理的情况下，可以显示当前页面的服务器 ip 。</p>
<p><img src="http://img.jayxhj.com/chrome-hosts-manager.jpg" alt="显示当前页面 ip"></p>
<h2 id="JSON-Editor"><a href="#JSON-Editor" class="headerlink" title="JSON Editor"></a>JSON Editor</h2><p>一句话介绍：JSON 在线解析及编辑器。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/lhkmoheomjbkfloacpgllgjcamhihfaj" target="_blank" rel="external">https://chrome.google.com/webstore/detail/lhkmoheomjbkfloacpgllgjcamhihfaj</a></p>
<p>开发者网站：<a href="http://jsoneditoronline.org/" target="_blank" rel="external">http://jsoneditoronline.org/</a></p>
<p>使用：<a href="http://jsoneditoronline.org/" target="_blank" rel="external">http://jsoneditoronline.org/</a> 的 chrome 扩展版本，可以用来修改 JSON 数据，并实时验证 JSON 数据的合法性，构造复杂的 JSON 数组、对象、字符串。</p>
<h2 id="JSONView"><a href="#JSONView" class="headerlink" title="JSONView"></a>JSONView</h2><p>一句话介绍：JSON 查看器。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/chklaanhfefbnpoihckbnefhakgolnmc" target="_blank" rel="external">https://chrome.google.com/webstore/detail/chklaanhfefbnpoihckbnefhakgolnmc</a></p>
<p>开发者网站：<a href="https://github.com/gildas-lormeau/JSONView-for-Chrome" target="_blank" rel="external">https://github.com/gildas-lormeau/JSONView-for-Chrome</a></p>
<p>使用：适合用来查看 JSON ，但是由于在解析当前页面时，如果发现是 JSON ，会再次请求一次页面，所以不适合查看、测试对多次请求结果不一致的 api 。之前写过一篇文章，介绍的就是 <a href="/2016/01/using-json-viewer-for-debugging/">使用 JSONView 配合进行 Debug</a> 。</p>
<h2 id="OneTab"><a href="#OneTab" class="headerlink" title="OneTab"></a>OneTab</h2><p>一句话介绍：可以节省 95% 内存使用的标签页管理工具。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/chphlpgkkbolifaimnlloiipkdnihall" target="_blank" rel="external">https://chrome.google.com/webstore/detail/chphlpgkkbolifaimnlloiipkdnihall</a></p>
<p>开发者网站：<a href="http://one-tab.com/" target="_blank" rel="external">http://one-tab.com/</a></p>
<p>用法：使用 OneTab 可以将暂时不需要处理的网页集中到一起，大大减小 Chrome 吃内存的问题。使用它可以对网页进行分组，可以随意更改标签页顺序，能分享自己的标签页给他人，并且让人放心的是，即使关闭浏览器，或者重启电脑， OneTab 里的内容还在，可以放心地使用，开发团队表示，后续将引入云端功能，保持多设备的同步，大快人心。使用 <code>Alt + Shift + 1</code> 即可呼出 OneTab 。</p>
<h2 id="Proxy-SwitchyOmega"><a href="#Proxy-SwitchyOmega" class="headerlink" title="Proxy SwitchyOmega"></a>Proxy SwitchyOmega</h2><p>一句话介绍：代理管理及切换工具。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/padekgcemlokbadohgkifijomclgjgif" target="_blank" rel="external">https://chrome.google.com/webstore/detail/padekgcemlokbadohgkifijomclgjgif</a></p>
<p>开发者网站：<a href="https://github.com/FelisCatus/SwitchyOmega" target="_blank" rel="external">https://github.com/FelisCatus/SwitchyOmega</a></p>
<h2 id="Search-by-Image-by-Google"><a href="#Search-by-Image-by-Google" class="headerlink" title="Search by Image (by Google)"></a>Search by Image (by Google)</h2><p>一句话介绍：Google 搜图工具。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/search-by-image-by-google/dajedkncpodkggklbegccjpmnglmnflm" target="_blank" rel="external">https://chrome.google.com/webstore/detail/search-by-image-by-google/dajedkncpodkggklbegccjpmnglmnflm</a></p>
<p>开发者网站：<a href="https://chrome.google.com/webstore/category/ext/15-by-google" target="_blank" rel="external">https://chrome.google.com/webstore/category/ext/15-by-google</a></p>
<p>使用：选中某个图片，右键，点击 <strong>Search Google with this image</strong>，即可搜索与此图类似的图片。其实就是调用的 Google Images 的服务。国内百度的 <a href="http://image.baidu.com/" target="_blank" rel="external">以图搜图</a> 做的也挺不错。</p>
<h2 id="Wikiwand-Wikipedia-Modernized"><a href="#Wikiwand-Wikipedia-Modernized" class="headerlink" title="Wikiwand: Wikipedia Modernized"></a>Wikiwand: Wikipedia Modernized</h2><p>一句话介绍：更美的维基百科。</p>
<p>地址：<a href="http://www.wikiwand.com/#/install" target="_blank" rel="external">http://www.wikiwand.com/#/install</a></p>
<p>开发者网站：<a href="http://www.wikiwand.com/" target="_blank" rel="external">http://www.wikiwand.com/</a></p>
<h2 id="印象笔记·剪藏"><a href="# 印象笔记·剪藏" class="headerlink" title="印象笔记·剪藏"></a>印象笔记·剪藏 </h2><p> 一句话介绍： 智能归类、剪辑、收藏、悦读并提供关键字搜索功能的印象笔记工具。</p>
<p>地址：<a href="https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc" target="_blank" rel="external">https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc</a></p>
<p>开发者网站：<a href="http://evernote.com/" target="_blank" rel="external">http://evernote.com/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/05/jayxhjs-chrome-extensions/" data-id="ciozl52cb0037896v0xrqqu4f" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/05/jayxhjs-chrome-extensions/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/">chrome</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/extensions/">extensions</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-basic-composer-package-development" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/basic-composer-package-development/" class="article-date">
  <time datetime="2016-05-13T07:28:41.000Z" itemprop="datePublished">2016-05-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/basic-composer-package-development/">动手开发自己的第一个 composer 包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>composer 是 PHP 的依赖管理工具，本篇文章就来说明如何构建一个包，并提交到 <a href="https://packagist.org/" target="_blank" rel="external">Packagist</a> ，这样别人就可以方便地通过 composer 使用你的包了。</p>
<p>开发 composer 包有以下几个步骤：</p>
<ol>
<li>初始化 composer.json 文件</li>
<li>定义命名空间及包名</li>
<li>实现包需要实现的功能</li>
<li>提交到 GitHub</li>
<li>在 Packagist 注册包</li>
</ol>
<h2 id="初始化 -composer-json- 文件"><a href="# 初始化 -composer-json- 文件" class="headerlink" title="初始化 composer.json 文件"></a>初始化 composer.json 文件 </h2><p> 安装好 composer 后即可在本地运行 <code>composer init</code> 通过交互式命令行设置 composer.json 。</p>
<p>下面介绍其中的几个属性，以及常规的设置：</p>
<ol>
<li>name<br><br>此属性定义包名，以 <code>/</code> 隔开，前面的为供应商名字，后面为包名，供应商代表 Packagist 网站为开发者提供的唯一的名字，用来组织包以及防止命名冲突。所以提交时最好先访问 <a href="https://packagist.org/packages/yourvendorname" target="_blank" rel="external">https://packagist.org/packages/yourvendorname</a> 将 url 中的 yourvendorname 替换为你想要取的名字，如果页面没有 404 ，说明已经被注册了。</li>
<li>license<br><br>许可证。关于许可证，建议看两篇文章，<a href="http://choosealicense.com/" target="_blank" rel="external">开源项目 license 介绍 </a> 、<a href="http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html" target="_blank" rel="external"> 如何选择 license</a></li>
<li>require<br><br>安装当前包所需的依赖。只有所有依赖被安装当前包才会被安装。</li>
<li>autoload<br><br>此配置下主要是 <strong>PSR-4</strong> 或者 <strong>PSR-0</strong> 设置，更推荐使用 PSR-4 标准。</li>
</ol>
<p><a href="http://json-schema.org/" target="_blank" rel="external">http://json-schema.org/</a> 上介绍了 JSON Schema 的定义以及各个语言对其各种功能的实现，有 validator 的实现，其中 <a href="http://www.jsonschemavalidator.net/" target="_blank" rel="external">JSON Schema Validator</a> 是在线的验证服务。其实最简单的就是使用 <code>composer validate composer.json</code> 来验证文件是否是有错误。</p>
<p>这是我演示的设置 composer.json 的视频</p>
<script type="text/javascript" src="https://asciinema.org/a/45460.js" id="asciicast-45460" async>
</script>

<h2 id="项目结构"><a href="# 项目结构" class="headerlink" title="项目结构"></a>项目结构 </h2><p> 以我开发的 <a href="https://packagist.org/packages/geosso/geosso" target="_blank" rel="external">单点登录 SDK</a> 为例，此项目基于 Laravel ，实现了站点接入单点登录系统的简单接入，应用只需在服务端注册并实现指定接口，即可接入 SSO 。</p>
<p>项目结构是典型的 MVC 结构，</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#10;&#9492;&#9472;&#9472; geo&#10;    &#9492;&#9472;&#9472; geosso&#10;        &#9500;&#9472;&#9472; LICENSE&#10;        &#9500;&#9472;&#9472; README.md&#10;        &#9500;&#9472;&#9472; composer.json&#10;        &#9492;&#9472;&#9472; src&#10;            &#9500;&#9472;&#9472; Contracts&#10;            &#9500;&#9472;&#9472; Http&#10;            &#9474;   &#9500;&#9472;&#9472; Controllers&#10;            &#9474;   &#9500;&#9472;&#9472; Middleware&#10;            &#9474;   &#9492;&#9472;&#9472; Requests&#10;            &#9500;&#9472;&#9472; ParamsBean&#10;            &#9500;&#9472;&#9472; Providers&#10;            &#9500;&#9472;&#9472; Support&#10;            &#9492;&#9472;&#9472; config&#10;&#10;12 directories</span><br></pre></td></tr></table></figure>
<p>LICENSE、README.md 及 composer.json 是运行 <code>tree -d</code> 之后手工添加上去的。</p>
<p>项目根目录定义在 src 下，在 composer.json 中也有定义，这样当 composer 加载这个包时就知道如何通过命名空间去解析文件路径。</p>
<p>Http 目录代表请求响应，之下的 Controllers 表示合法请求的控制器，Middleware 代表请求的第一道关卡，通过中间件去拦截请求，Requests 去获取前端请求并对请求过滤。</p>
<p>Contracts 代表接口定义。ParamsBean 代表应用层与底层服务沟通时的参数封装，通过 Bean 去获取各个参数，而不是传递 array 使得调用一致，并且强制接口调用时做类型检测，可以很大程度上统一各层之间的参数传递。</p>
<p>Providers 代表 Laravel 的服务容器，通过服务容器，可以注册路由与配置，加载助手类，绑定接口与其实现。</p>
<p>Support 就是一些助手类，对常用的与逻辑无关的功能的封装，config 代表应用自己的配置，通过 config 可以方便地将配置设置并使用全局函数 <code>config()</code> 调用。</p>
<h2 id="提交至 -GitHub"><a href="# 提交至 -GitHub" class="headerlink" title="提交至 GitHub"></a>提交至 GitHub</h2><p>按照前面的步骤，一个包就有了基本的骨架，接下来就是上传至 GitHub ，配置项目，集成持续集成服务，发布开源项目许可证。</p>
<p>GitHub 初始化项目时可以选择生成 .gitignore 文件，选择许可证，初始化 README.md 文件，切换至本地的项目目录后，按如下步骤即可将目录上传至 GitHub：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;git init <span class="comment"># 初始化仓库</span></span><br><span class="line">&gt;git remote <span class="built_in">set</span>-url origin --push --add git@github.com:jayxhj/geosso.git <span class="comment"># 添加远程追踪仓库地址</span></span><br><span class="line">&gt; git add .</span><br><span class="line">&gt; git commit</span><br><span class="line">&gt; git push origin master</span><br></pre></td></tr></table></figure>
<h2 id="提交至 -Packagist"><a href="# 提交至 -Packagist" class="headerlink" title="提交至 Packagist"></a>提交至 Packagist</h2><p>Packagist 为 composer 默认获取包元数据信息的地址，从 Packagist 获取到元数据信息后，再从 GitHub 上拉取代码。因此，当把你开发的包上传至 GitHub 后还需要将其在 Packagist 注册，这样全世界的人都能通过 composer 去拉去你的代码了。</p>
<p>提交至 Packagist 只需三个步骤：</p>
<ol>
<li>注册帐号</li>
<li>在 <a href="https://packagist.org/packages/submit" target="_blank" rel="external">https://packagist.org/packages/submit</a> 提交开发包</li>
<li>设置 webhook 以便提交包更新后能及时地同步至 Packagist</li>
</ol>
<p>自此，一个基本的包开发就结束了。通过 composer 来管理 PHP 的依赖，通过编写 composer package 去扩展自己的类库，通过引入其他的类库来填充自己的功能，就不用重复造轮子了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/05/basic-composer-package-development/" data-id="ciozl52eo004x896v3ems1lra" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/05/basic-composer-package-development/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/composer/">composer</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-get-week-number-in-month-from-date-in-php" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/get-week-number-in-month-from-date-in-php/" class="article-date">
  <time datetime="2016-04-26T11:44:42.000Z" itemprop="datePublished">2016-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">php</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/get-week-number-in-month-from-date-in-php/">获取当前日期在本月的第几周</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="获取当前日期在本月的第几周"><a href="# 获取当前日期在本月的第几周" class="headerlink" title="获取当前日期在本月的第几周"></a>获取当前日期在本月的第几周 </h1><p> 使用 <strong>date()</strong> 函数可以获取某个日期的当前星期数，此星期数为当前日期在一整年中的星期数。假如要获取当前日期在当前月份的星期数，只需用当前日期的星期数减去当前月份第一天的星期数加 1 即可。</p>
<h2 id="获取当前日期的星期数"><a href="# 获取当前日期的星期数" class="headerlink" title="获取当前日期的星期数"></a>获取当前日期的星期数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> date(<span class="string">'W'</span>,time());</span><br></pre></td></tr></table></figure>
<h2 id="获取当前日期是本月的第几周"><a href="# 获取当前日期是本月的第几周" class="headerlink" title="获取当前日期是本月的第几周"></a>获取当前日期是本月的第几周</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@param</span> int $date 时间戳</span><br><span class="line"> * <span class="doctag">@return</span> int 当前日期在本月的第几周</span><br><span class="line"> *</span><br><span class="line"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weekOfMonth</span><span class="params">(<span class="variable">$date</span>)</span> </span>&#123;</span><br><span class="line">    <span class="variable">$firstOfMonth</span> = strtotime(date(<span class="string">"Y-m-01"</span>, <span class="variable">$date</span>));</span><br><span class="line">    <span class="keyword">return</span> intval(date(<span class="string">"W"</span>, <span class="variable">$date</span>)) - intval(date(<span class="string">"W"</span>, <span class="variable">$firstOfMonth</span>)) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/04/get-week-number-in-month-from-date-in-php/" data-id="ciozl52dk0044896v48li2bn7" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/04/get-week-number-in-month-from-date-in-php/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-lumen-tricks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/lumen-tricks/" class="article-date">
  <time datetime="2016-04-09T14:09:26.000Z" itemprop="datePublished">2016-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/lumen-tricks/">Lumen 常用开发技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="密码加密与验证"><a href="# 密码加密与验证" class="headerlink" title="密码加密与验证"></a>密码加密与验证 </h1><p> 加密</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 密码入库加密</span><br><span class="line">* <span class="doctag">@param</span> string $password</span><br><span class="line">* <span class="doctag">@return</span> string</span><br><span class="line">*</span><br><span class="line">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">passwordEncrypt</span><span class="params">(<span class="variable">$password</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> app(<span class="string">'hash'</span>)-&gt;make(<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>密码验证</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 密码验证</span><br><span class="line">* <span class="doctag">@param</span> string $password</span><br><span class="line">* <span class="doctag">@param</span> string $hashedPassword 加密后的密码</span><br><span class="line">* <span class="doctag">@return</span> bool</span><br><span class="line">*</span><br><span class="line">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">passwordValidate</span><span class="params">(<span class="variable">$password</span>, <span class="variable">$hashedPassword</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> app(<span class="string">'hash'</span>)-&gt;check(<span class="variable">$password</span>, <span class="variable">$hashedPassword</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查询数据库判断是否有记录"><a href="# 查询数据库判断是否有记录" class="headerlink" title="查询数据库判断是否有记录"></a>查询数据库判断是否有记录 </h2><p> 如果使用 Eloquent 的 <a href="https://laravel.com/docs/5.2/eloquent#query-scopes" target="_blank" rel="external">Query Scopes</a> ，查询时使用链式方法调用，通常是这么查询，<code>$modelObj = Model::id($id)-&gt;get()</code> 来查询指定条件的结果集。但是这么查出来的，实际上返回的是 <code>Illuminate\Support\Collection</code> 对象。那么下面的方法，比较适合判断查出来的结果是否存在。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="variable">$modelObj</span> = Model::id(<span class="variable">$id</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="variable">$modelObj</span>-&gt;isEmpty()) &#123;</span><br><span class="line">    <span class="variable">$modelObj</span>-&gt;toArray();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者这样</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$modelObj</span>-&gt;count()) &#123;</span><br><span class="line">    <span class="variable">$modelObj</span>-&gt;toArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/04/lumen-tricks/" data-id="ciozl52bs002q896vztpqmfvq" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/04/lumen-tricks/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lumen/">lumen</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-setting-timezones-in-lumen" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/setting-timezones-in-lumen/" class="article-date">
  <time datetime="2016-03-24T11:17:10.000Z" itemprop="datePublished">2016-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/setting-timezones-in-lumen/">在 lumen 中设置日期与数据库时区</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>项目使用了 Laravel 的精简版 Lumen 来做 api 和 sso 的服务。今天在提交代码时发现，生成的 database migration 代码时间相差八个小时。看来是时区设置的问题，查找了一下，发现有好几个地方都有时区的设置，那就简单总结一下。</p>
<h2 id="PHP- 时区设置"><a href="#PHP- 时区设置" class="headerlink" title="PHP 时区设置"></a>PHP 时区设置</h2><p>PHP 里可以在 php.ini 中设置 <strong><code>date.timezone</code></strong> 选项来设置时区，也可以在脚本中动态制定时区，如使用 <strong><code>date_default_timezone_set()</code></strong> 来动态指定时区。使用脚本指定时会覆盖 php.ini 中的设置。时区列表可以使用 <strong><code>\DateTimeZone::listIdentifiers()</code></strong> 来获取。也可以到 <a href="http://lxr.php.net/xref/PHP_5_6/ext/date/lib/timezonemap.h" target="_blank" rel="external">timezonemap.h</a> 来查看对应的可选项。</p>
<p>中国的时区设置可以使用以下选项：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Chongqing"</span>                &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Chungking"</span>                &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Harbin"</span>                   &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Macao"</span>                    &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Macau"</span>                    &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Shanghai"</span>                 &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"Asia/Taipei"</span>                   &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"PRC"</span>                           &#125;,</span><br><span class="line">&#123; <span class="string">"cst"</span>,   <span class="number">0</span>,  <span class="number">28800</span>, <span class="string">"ROC"</span>                           &#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="lumen- 时区设置"><a href="#lumen- 时区设置" class="headerlink" title="lumen 时区设置"></a>lumen 时区设置</h2><p>lumen 的时区设置有数据库操作的时区设置以及与使用时间相关的函数的时区设置。</p>
<h3 id="日期相关设置"><a href="# 日期相关设置" class="headerlink" title="日期相关设置"></a>日期相关设置 </h3><p> 在 lumen 中应用程序的入口，会 new 一个 Application 实例，这个实例会读取 env 配置文件中的 <strong>APP_TIMEZONE</strong> 配置，若没有配置则会使用 UTC 时间。Application 位于 <code>/path/to/project/vendor/laravel/lumen-framework/src/Application.php</code> 。所以最好是在 .env 中设置时区 <code>APP_TIMEZONE=PRC</code> 。</p>
<h3 id="数据库"><a href="# 数据库" class="headerlink" title="数据库"></a>数据库 </h3><p> 数据库的时区设置可以在 config 的 database 文件中设置。database 文件分两个，一个是框架级别，一个是项目级别。框架级别的文件位于 <code>/path/to/project/vendor/laravel/lumen-framework/config/database.php</code> ，而项目级别的文件位于 <code>/path/to/project/config/database.php</code> 。</p>
<p>此配置是和 MySQL 相关的，所以关键字当然是去 MySQL 中找。在 <a href="https://dev.mysql.com/doc/refman/5.5/en/time-zone-support.html" target="_blank" rel="external">MySQL 时区设置</a> 文档中可以看到，有以下三种配置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. SYSTEM 表示与系统时区相同</span><br><span class="line">2. '+10:00' or '-6:00' 表示与 UTC 时间的一个偏移量</span><br><span class="line">3. 'Europe/Helsinki', 'US/Eastern', or 'MET' 表示命名时区，命名时区必须在 mysql 库下的 time_zone_name 有注册</span><br></pre></td></tr></table></figure>
<p>导入时区的命令为 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root --database=mysql -p</span><br></pre></td></tr></table></figure>
<p>建议是在项目级别设置时区。在 .env 中指定 <code>DB_TIMEZONE=+08:00</code> 和在 database 中指定 <code>&#39;timezone&#39;  =&gt; env(&#39;DB_TIMEZONE&#39;, &#39;+08:00&#39;)</code> 均可。</p>
<h2 id="总结"><a href="# 总结" class="headerlink" title="总结"></a>总结 </h2><p> 时区设置分为 PHP 时区设置和 MySQL 的时区设置。PHP 时区设置涉及到 php.ini 配置以及运行时配置，而在 lumen 中还涉及到环境变量的配置。lumen 中既可以在 config 目录下的文件中指定，也可以在 .env 文件中指定。建议既指定 PHP 的配置又指定环境变量的配置，环境变量的配置可供整个应用程序使用，是项目级别的共享配置。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/03/setting-timezones-in-lumen/" data-id="ciozl52ac001q896vu5lut0pc" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/03/setting-timezones-in-lumen/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lumen/">lumen</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/timezone/">timezone</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-single-double-quote-and-backtick" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/single-double-quote-and-backtick/" class="article-date">
  <time datetime="2016-03-20T10:32:36.000Z" itemprop="datePublished">2016-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/single-double-quote-and-backtick/">反引号 (`)  与 单引号 (&#39;) 以及 双引号 (&#39;&#39;) 的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>反引号 <code>` </code> (backtick) 与单引号 <code>&#39;</code>(single quote) 以及双引号 <code>&quot;</code> (double quote) 在 PHP 及 MySQL 中都有不同的含义，下面将分别说明并给出它们在 PHP 和 MySQL 结合使用时的一些注意事项。</p>
<h2 id="在 -PHP- 中"><a href="# 在 -PHP- 中" class="headerlink" title="在 PHP 中"></a>在 PHP 中 </h2><p><code>` </code> 在 PHP 中是 <a href="http://php.net/manual/zh/language.operators.execution.php" target="_blank" rel="external"> 执行运算符</a>，效果与调用 <a href="http://php.net/manual/zh/function.shell-exec.php" target="_blank" rel="external">shell_exec()</a>  相同 。</p>
<p><code>&#39;</code> 在 PHP 中用来输出字面量值，被单引号括起来的内容会被原样输出。</p>
<p><code>&quot;</code> 在 PHP 中可以用来解析变量。</p>
<h2 id="在 -MySQL- 中"><a href="# 在 -MySQL- 中" class="headerlink" title="在 MySQL 中"></a>在 MySQL 中</h2><p><code>` </code> 被用来在查询，告诉解析器反引号内的内容表示一个字面量，直接读取而不用做变量替换。</p>
<p><code>&quot;</code> 与 <code>&#39;</code> 用来均被用来解析 MySQL 字符串及 <a href="http://dev.mysql.com/doc/refman/5.7/en/string-literals.html#character-escape-sequences" target="_blank" rel="external">特殊字符</a> ，不过这与 MySQL 的 SQL mode 设置有关。当 <code>ANSI_QUOTES</code> 开启时，<code>&quot;</code> 将被当作标识符。</p>
<h3 id="SQL-mode"><a href="#SQL-mode" class="headerlink" title="SQL mode"></a>SQL mode</h3><p>MySQL 中开启 ANSI mode 时将会使用 <code>&#39;</code> 来告诉解析器，<code>&#39;</code> 内包裹的字符串字面量直接读取，无需解析。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET SESSION sql_mode ='ANSI_QUOTES';</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT 'hello', '"hello"', '""hello""', 'hel''lo','\'hello','\r';</span><br><span class="line">+-------+---------+-----------+--------+--------+---+</span><br><span class="line">| hello | "hello" | ""hello"" | hel'lo |'hello |   |</span><br><span class="line">+-------+---------+-----------+--------+--------+---+</span><br><span class="line"> |hello | "hello" | ""hello"" | hel'lo |'hello |</span><br><span class="line">+-------+---------+-----------+--------+--------+---+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT "hello", '"hello"', '""hello""', 'hel''lo','\'hello','\r';</span><br><span class="line">ERROR 1054 (42S22): Unknown column 'hello' in 'field list'</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT hello, '"hello"', '""hello""', 'hel''lo','\'hello','\r';</span><br><span class="line">ERROR 1054 (42S22): Unknown column 'hello' in 'field list'</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT `hello`, '"hello"', '""hello""', 'hel''lo','\'hello','\r';</span><br><span class="line">ERROR 1054 (42S22): Unknown column 'hello' in 'field list'</span><br></pre></td></tr></table></figure>
<h2 id="PHP- 执行 -MySQL- 查询"><a href="#PHP- 执行 -MySQL- 查询" class="headerlink" title="PHP 执行 MySQL 查询"></a>PHP 执行 MySQL 查询 </h2><p> 为了防止 SQL 注入，最好使用预处理语句及参数绑定来执行查询。建议使用 <a href="http://php.net/manual/en/book.pdo.php" target="_blank" rel="external">PDO</a> 或者 <a href="http://php.net/manual/en/book.mysqli.php" target="_blank" rel="external">MySQLi</a></p>
<ul>
<li><p>PDO    </p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span>    </span><br><span class="line"><span class="variable">$dbh</span> = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=test'</span>, <span class="variable">$user</span>, <span class="variable">$pass</span>);</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$dbh</span>-&gt;prepare(<span class="string">"INSERT INTO REGISTRY (name, value) VALUES (:name, :value)"</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;bindParam(<span class="string">':name'</span>, <span class="variable">$name</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;bindParam(<span class="string">':value'</span>, <span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>MySQLi</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="variable">$mysqli</span> = <span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"user"</span>, <span class="string">"password"</span>, <span class="string">"database"</span>);</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$mysqli</span>-&gt;prepare(<span class="string">"INSERT INTO `test`(`id`) VALUES (?)"</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;bind_param(<span class="string">"i"</span>, <span class="variable">$id</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="实践"><a href="# 实践" class="headerlink" title="实践"></a>实践</h2><p>SQL 标准规定使用 <code>&#39;</code> 来包裹字符串，但不同的数据库有不同的实现，最好的方式，当然是使用 PDO ，这样就不用对 sql 语句单独进行处理，而且在转换数据库时业务逻辑中的 sql 也无需修改和转换。</p>
<p>最好的实践其实应该在代码设计上规避错误：</p>
<ol>
<li>取名不与 <a href="http://dev.mysql.com/doc/refman/5.5/en/reserved-words.html" target="_blank" rel="external">MySQL 保留字</a> 冲突 </li>
<li>清楚 MySQL 服务器 SQL mode <strong><code>SELECT @@sql_mode</code></strong></li>
<li>使用 <code>` </code> 包裹表名及列名</li>
<li>使用 <code>&#39;</code> 包裹查询条件</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/03/single-double-quote-and-backtick/" data-id="ciozl52a7001k896vx402ac2c" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/03/single-double-quote-and-backtick/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/quote/">quote</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-fix-headers-already-sent-error-in-php" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/fix-headers-already-sent-error-in-php/" class="article-date">
  <time datetime="2016-03-09T05:32:16.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/翻译文章/">翻译文章</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/fix-headers-already-sent-error-in-php/">解决 PHP &quot;headers already sent&quot; 错误</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章是 stackoverflow 上的一个问题的回答，答案集中了其它答案的想法，并做了归纳，所以翻译过来，以后遇到 “headers already sent” 的错误就可以直接一一排查，或者干脆在代码动手及设计上避免这类问题了。</p>
<h2 id="发送 -header- 前不要有任何输出"><a href="# 发送 -header- 前不要有任何输出" class="headerlink" title="发送 header 前不要有任何输出"></a>发送 header 前不要有任何输出 </h2><p> 发送或者修改 HTTP 头信息的方法必须在任何输出被输出之前被调用。否则调用将会出错：</p>
<blockquote>
<p>Warning: Cannot <strong>modify</strong> header information - headers already sent (<strong>output</strong> started at script:line)</p>
</blockquote>
<p>这些方法可以修改（modify） HTTP 头信息：</p>
<ul>
<li><a href="http://php.net/header" target="_blank" rel="external">header</a> / <a href="http://php.net/header_remove" target="_blank" rel="external">header_remove</a></li>
<li><a href="http://php.net/session_start" target="_blank" rel="external">session_start</a> / <a href="http://php.net/session_regenerate_id" target="_blank" rel="external">session_regenerate_id</a></li>
<li><a href="http://php.net/setcookie" target="_blank" rel="external">setcookie</a> / <a href="http://php.net/setrawcookie" target="_blank" rel="external">setrawcookie</a></li>
</ul>
<p>输出（output）可以是：</p>
<ul>
<li>无意的：<ul>
<li><code>&lt;?php</code> 之前或者 <code>?&gt;</code> 之后的空格</li>
<li><a href="https://zh.wikipedia.org/wiki/ 位元組順序記號" target="_blank" rel="external">UTF-8 BOM</a> </li>
</ul>
</li>
<li>有意的：<ul>
<li><code>print</code> ，<code>echo</code> 以及其他能产生输出的方法</li>
<li>在 <code>&lt;?php</code> 前原始的 <code>&lt;html&gt;</code> 区块</li>
</ul>
</li>
</ul>
<h2 id="为什么这个错误会产生"><a href="# 为什么这个错误会产生" class="headerlink" title="为什么这个错误会产生"></a>为什么这个错误会产生 </h2><p> 为了理解为什么 HTTP header 必须在输出之前发送出去，我们有必要了解看一下一个典型的 HTTP 相应。PHP 脚本主要用来生成 HTML ，但它也会发送一系列的 HTTP/CGI 头信息到 web 服务器：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Powered-By: PHP/5.3.7</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span><span class="tag">&lt;<span class="title">title</span>&gt;</span>PHP page output page<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Content<span class="tag">&lt;/<span class="title">h1</span>&gt;</span> <span class="tag">&lt;<span class="title">p</span>&gt;</span>Some more output follows...<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">and <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/"</span>&gt;</span> <span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">internal-icon-delayed</span>&gt;</span> <span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>页面或者输出总是紧跟在头信息后面。PHP 必须先把头信息发送给 web 服务器，并且它只能发送一次，在这之后就再也不能修改头信息了。</p>
<p>当 PHP 第一次接收到输出时（<code>print</code> ,<code>echo</code>,<code>&lt;html&gt;</code>） 它会清掉所有收集到的头信息。在此之后它能把输出所有想输出的内容，但是再想发送 HTTP 头信息就不可能了。</p>
<h2 id="怎么找到到底是哪里提前产生了输出？"><a href="# 怎么找到到底是哪里提前产生了输出？" class="headerlink" title="怎么找到到底是哪里提前产生了输出？"></a>怎么找到到底是哪里提前产生了输出？</h2><p><code>header()</code> 头信息包含所有与问题产生相关的信息：</p>
<blockquote>
<p>Warning: Cannot modify header information - headers already sent by (output started at /www/usr2345/htdocs/auth.php:52) in /www/usr2345/htdocs/index.php on line 100</p>
</blockquote>
<p>在上面的警告中，<code>line 100</code> 指向调用 <code>header()</code> 失败的脚本行数。</p>
<p>圆括号里的 <code>output started</code>  这条信息更加重要。它指出了先于 header() 前的输出的源头。在这个例子中是 <code>auth.php</code> 的 第 52 行，这就是你要去找的过早的输出的地方。</p>
<p>典型的原因有这些：</p>
<ol>
<li><p><strong>print</strong>,<strong>echo</strong><br>有意的 <code>print</code> 和 <code>echo</code> 语句输出将会中断输出 HTTP 头信息的机会。应用程序流必须重组以避免这种行为，可以使用 <a href="http://php.net/function" target="_blank" rel="external">function</a> 和模版来重组，从而保证 <code>header()</code> 调用是在信息被写出之前。<br>产生输出的方法包括：    </p>
<ul>
<li>print, echo, printf, vprintf</li>
<li>trigger_error, ob_flush, ob_end_flush, var_dump, print_r</li>
<li>readfile, passthru, flush, imagepng, imagejpeg    </li>
</ul>
<p>以及其他用户自定义的方法。</p>
</li>
<li><p><strong>原始的 HTML</strong><br>在一个 PHP 文件中未被解析的 HTML 区块也是输出。脚本中各种可能触发调用 <code>header()</code> 的条件都必须在任何 <code>&lt;html&gt;</code> 区块前声明。</p>
</li>
<li><p><strong>&lt;?php 前的空格导致的 <code>&quot;script.php line 1&quot;</code> 警告 </strong><br> 如果警告指向第 <strong>1</strong> 行的输出，那么它很有可能指向的是在 <code>&lt;?php</code> 之前的空格，文本或者 HTML 。    </p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="comment">// 在 &lt;?php 前有个空格</span></span><br></pre></td></tr></table></figure>
<p>同样它可能出现在附加的脚本或者脚本区块上:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">&lt;?php</span></span><br></pre></td></tr></table></figure>
<p>PHP 确实在闭合标签后占据了一个换行符，但是它不会在上面的空白处插入换行符、制表符或者空格（也就是说这是我们自己造成的）。    </p>
</li>
<li><p><strong>UTF-8 BOM</strong><br>换行符或者空格可能导致问题，但是不可见的字符序列同样可以。最著名的就是大多数文本编辑器并不会显示的 <strong>UTF-8 BOM</strong> 。它是在 UTF-8 编码的文档里可选甚至是多余的，被标示为 <code>EF BB BF</code> 的字节序列。但是 PHP 必须把它当作原始的输出来处理。它可能以 <code>ï»¿</code> 这样的符号输出（如果客户端以 Latin-1 来解释这个文档）或者其他这样的“非法输出”。<br>以某种图形化的编辑器或者基于 JAVA 的 IDE 查看这类文件时，你可能察觉不到 <strong>UTF-8 BOM</strong> 的存在。它们没有把 <strong>UTF-8 BOM</strong> 形象化（受制于 Unicode 标准）。然而大多数程序编辑器和控制台编辑程序会这样处理：<br><img src="http://i.stack.imgur.com/aXgWY.png" alt=""><br>像这样就能简单地提早发现问题了。其他的编辑器在设置某些选项后也能纠正这样的问题（Windows 上的 Notepad++ 可以识别并且 <a href="http://stackoverflow.com/questions/3589358/fix-utf8-bom"target="_blank"rel="external">纠正 BOM 问题 </a> ），另一个发现 BOM 的方法就是借助十六进制的编辑器。在 *nix 系统上，大都提供了 <a href="http://linux.die.net/man/1/hexdump"target="_blank"rel="external"><code>hexdump</code></a>  ，如果没有的话，其他图形化的变种也可以用来简化审计这些问题的步骤：<br><img src="http://i.stack.imgur.com/QyqUr.png"alt=""><br> 一个简单的修正方法就是将文本编辑器设置为  <strong>以 UTF-8 (no BOM) 保存文件</strong>（<strong>save files as UTF-8 (no BOM)</strong>）或者其他类似的设置。    </p>
<h3 id="修正程序"><a href="# 修正程序" class="headerlink" title="修正程序"></a>修正程序 </h3><p> 有很多自动化的工具可以检测并修改文本文件（<a href="http://stackoverflow.com/questions/1068650/using-awk-to-remove-the-byte-order-mark" target="_blank" rel="external"><code>sed</code></a> / <a href="http://stackoverflow.com/questions/1068650/using-awk-to-remove-the-byte-order-mark" target="_blank" rel="external"><code>awk</code></a> 或者 <code>recode</code> ）。PHP 里有 <a href="http://freshcode.club/projects/phptags" target="_blank" rel="external"><code>phptags</code></a> 。它可以把打开标签和关闭标签重写成长标签（&lt;?php）或者短标签（&lt;?）的形式。也可以轻松地解决前导或尾随的空格、Unicode 和 UTF-x BOM 问题：    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phptags  --whitespace  *.php</span><br></pre></td></tr></table></figure>
<p>同样，你可以在某个目录或整个项目目录使用这个命令。</p>
</li>
<li><p><strong>?&gt; 后的空白 </strong><br> 如果错误代码在闭合标签 &gt;? 这一行的前面，那么这就是 &gt;? 后的空格或者原始文本输出导致的问题。PHP 的结束标记并不会在遇到闭合标签时终止执行脚本，任何 ?&gt; 之后的文本或者空格字符都会被当作页面内容输出。<br>通用的被鼓励的做法，特别是针对新手，是避免在 PHP 文件后加上闭合标签 <strong>?&gt;</strong> 。这样就能避免一部分产生这类问题的情况。</p>
</li>
<li><p><strong>错误源提示：”Unknown on line 0”</strong><br>如果没有给出具体的错误源，那么这就是典型的 PHP 扩展或者 <code>php.ini</code> 设置的问题：</p>
<ul>
<li>偶尔是 <code>gzip</code> 编码设置或者是 <a href="http://stackoverflow.com/questions/622192/php-warning-headers-already-sent-in-unknown" target="_blank" rel="external"><code>ob_gzhandler</code></a></li>
<li>也有可能是 php.ini 设置里模块加载了两次导致 PHP 产生了启动 / 警告信息</li>
</ul>
</li>
<li><p><strong>先前的错误导致输出了错误信息 </strong><br> 如果前面的 PHP 语句或者表达式造成了 warning 或者 notice 信息导致输出，这些输出也被认为是过早地输出。<br>在这种情况下你需要避免错误，推后这些语句的执行，或者抑制这些信息的输出，可以使用 <code>isset()</code> 进行判断，或者使用抑制符 <code>@</code>，前提是它们不会阻止后续的调试。</p>
</li>
</ol>
<h2 id="没有错误信息输出"><a href="# 没有错误信息输出" class="headerlink" title="没有错误信息输出"></a>没有错误信息输出 </h2><p> 如果你禁用了 php.ini 里的 <code>error_reporting</code> 或者 <code>display_errors</code> 设置，那么将不会产生 warning 。但是忽略错误并不会让问题消失，头信息仍然不能在过早的输出输出之前发送出去。</p>
<p>所以当 <code>header(&quot;Location: ...&quot;)</code> 跳转静默地失败时，建议你去查看 warnings 。在脚本的最前面用下面的两条命令重新开启错误报告设置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(E_ALL);</span><br><span class="line">ini_set("display_errors", 1);</span><br></pre></td></tr></table></figure>
<p>或者如果其他的设置都失败了那就设置  <code>set_error_handler(&quot;var_dump&quot;);</code> 。</p>
<p>至于跳转的 header ，在执行至最后的代码时你应该遵循下面的这种风格：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span>(header(<span class="string">"Location: /finished.html"</span>));</span><br></pre></td></tr></table></figure>
<p>最好是提供一个方法，特别是当 <code>header()</code> 执行失败时打印出用户信息。</p>
<h2 id="变通方法：输出缓冲"><a href="# 变通方法：输出缓冲" class="headerlink" title="变通方法：输出缓冲"></a>变通方法：输出缓冲</h2><p>PHP 的输出缓冲的方法是缓解这种问题的一种变通方法。它运行起来可靠，但是你绝不要使用它来替代你架构良好应用程序结构，从控制逻辑中分离输出。它的真实目的是用来减轻大块数据传输至服务器时的压力。</p>
<ol>
<li><a href="http://php.net/manual/en/outcontrol.configuration.php" target="_blank" rel="external"><code>output_buffering 设置</code></a> 在 <a href="http://www.php.net/manual/en/configuration.file.php" target="_blank" rel="external">php.ini</a> 或者 <a href="http://www.php.net/manual/en/configuration.changes.php" target="_blank" rel="external">.htaccess</a> 或者甚至在最新的 FPM/FastCGI  的 <a href="http://php.net/manual/en/configuration.file.per-user.php" target="_blank" rel="external">.user.ini</a> 中设置；</li>
<li>同样你可以在脚本的最前面使用 <a href="http://php.net/ob_start" target="_blank" rel="external"><code>ob_start()</code></a> 来设置，但是它并没那么可靠：  <ul>
<li>即使 <code>&lt;?php ob_start(); ?&gt;</code> 在第一个脚本里，空格或者 BOM 也有可能在此之前被输出</li>
<li>它可以隐藏 HTML 输出里的空格（将空格放到 buffer 中），但是只要应用程序逻辑企图发送二进制内容（比如生成的图片），缓冲里的无关的输出就会成为问题（这样 ob_clean() 方法就成为下一步的变通方法了）。</li>
<li>缓冲有大小限制，并且在默认配置下很容易超出，并且这种情况并不少见，一旦发生也不太容易追踪。</li>
</ul>
</li>
</ol>
<p>因此这两个方法变得不可靠了，特别是当你需要更改开发环境或者生产环境的配置的时候。这就是为什么输出缓冲被认为只是一种蹩脚的变通方法。</p>
<p>建议参考官方手册里的基本 <a href="http://www.php.net/manual/en/outcontrol.examples.basic.php" target="_blank" rel="external">使用方法</a> ，以及它的优缺点：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/2832010/what-is-output-buffering" target="_blank" rel="external">输出缓冲是什么</a></li>
<li><a href="http://stackoverflow.com/questions/2148114/why-use-output-buffering-in-php" target="_blank" rel="external">为什么使用 output buffering</a></li>
<li><a href="http://stackoverflow.com/questions/4731375/is-using-output-buffering-considered-a-bad-practice" target="_blank" rel="external">使用输出缓冲是不好的实践吗？</a></li>
<li><a href="http://stackoverflow.com/questions/2919569/use-case-for-output-buffering-as-the-correct-solution-to-headers-already-sent" target="_blank" rel="external">正确使用 output buffering 解决 “header already sent” 的例子</a></li>
</ul>
<h3 id="但是在其他的服务器上是好的？"><a href="# 但是在其他的服务器上是好的？" class="headerlink" title="但是在其他的服务器上是好的？"></a><strong>但是在其他的服务器上是好的？</strong></h3><p>如果你之前没有收到过头信息的 warning ，那么 php.ini 里的 <a href="http://php.net/manual/zh/outcontrol.configuration.php" target="_blank" rel="external">output_buffering</a> 设置改变了。在现在的／不同的服务器上很有可能没有设置。</p>
<h2 id="使用 -headers-sent- 检查"><a href="# 使用 -headers-sent- 检查" class="headerlink" title="使用 headers_sent() 检查"></a><strong>使用 <code>headers_sent()</code> 检查 </strong></h2><p> 你可以使用 <a href="http://php.net/headers_sent" target="_blank" rel="external"><code>headers_sent</code></a> 来检查是否可以发送头信息。这种方法可以有效地检查以便输出一个错误信息或是应用其他的逻辑。<br>不错的回退变通方法有：    </p>
<ul>
<li><p><strong>HTML<code>&lt;meta&gt;</code> tag</strong><br>  如果你的应用程序很难在结构上解决这个问题，有个简单但显得不专业的做法是在 HTML <meta> 标签中来跳转网页。可以这样实现：    </p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Location"</span> <span class="attribute">content</span>=<span class="value">"http://example.com/"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  或者加上一个延迟时间</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Refresh"</span> <span class="attribute">content</span>=<span class="value">"2; url=../target.html"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>JavaScript 跳转<br>  另一个可选的方法就是使用 <a href="http://stackoverflow.com/questions/503093/how-can-i-make-a-redirect-page-in-jquery-javascript" target="_blank" rel="external">JavaScript 跳转</a> 来实现网页跳转：</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62; location.replace(&#34;target.html&#34;); &#60;/script&#62;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这种方式相比较 <meta> 方法起来更兼容 HTML 标准，它只依赖于可以运行 JavaScript 的客户端。</p>
<p>这两种方式在 HTTP header() 调用失败时都提供了可以接受的回退方式。理想化的处理方式应该是将跳转与其它方式结合，给出对用户友好的辅助信息并且提供一个可点的链接以供后续操作。</p>
<h2 id="为什么 -setcookie- 和 -session-start- 都会被影响"><a href="# 为什么 -setcookie- 和 -session-start- 都会被影响" class="headerlink" title="为什么 setcookie() 和 session_start() 都会被影响"></a><strong>为什么 <code>setcookie()</code> 和 <code>session_start()</code> 都会被影响</strong></h2><p><code>setcookie()</code> 和 <code>session_start()</code> 都需要发送一个 <code>set-cookie:</code> 的 HTTP 头信息。这种情况就和前面输出 header() 的情况类似，所以同样会出现由于过早地输出错误信息导致的错误。</p>
<p>（当然它们受影响也有可能是因为客户端禁止了 cookie 导致的，设置可能是代理的问题。很明显，session 也取决去剩余磁盘空间大小或者 php.ini 里的其它设置）</p>
<hr>
<p>原文链接：<a href="http://stackoverflow.com/questions/8028957/how-to-fix-headers-already-sent-error-in-php" target="_blank" rel="external">http://stackoverflow.com/questions/8028957/how-to-fix-headers-already-sent-error-in-php</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/03/fix-headers-already-sent-error-in-php/" data-id="ciozl52dn0048896vfs8mejy7" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/03/fix-headers-already-sent-error-in-php/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/header/">header()</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-understanding-exit-codes-and-how-to-use-them-in-bash-scripts" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/" class="article-date">
  <time datetime="2016-02-27T10:51:02.000Z" itemprop="datePublished">2016-02-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/翻译文章/">翻译文章</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/">理解 Exit Code 并学会如何在 Bash 脚本中使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Exit-Codes- 是什么"><a href="#Exit-Codes- 是什么" class="headerlink" title="Exit Codes 是什么"></a>Exit Codes 是什么 </h2><p> 在 Unix 和 Linux 系统中，程序可以在执行终止后传递值给其父进程。这个值被称为退出码（exit code）或退出状态（exit status）。在 POSIX 系统中，惯例做法是当程序成功执行时传递 0 ，当程序执行失败时传递 1 或比 1 大的值。</p>
<p>传递状态码为何重要？如果你在命令行脚本上下文中查看状态码，答案显而易见。任何有用的脚本，它将不可避免地要么被其他脚本所使用，要么被 bash 单行脚本包裹所使用。特别是脚本被用来与自动化工具 SaltStack 或者监测工具 Nagios 配合使用。这些工具会执行脚本并检查它的状态，来确定脚本是否执行成功。</p>
<p>其中最重要的原因是，即使你不定义状态码，它仍然存在于你的脚本中。如果你不定义恰当的退出码，执行失败的脚本可能会返回成功的状态，这样会导致问题，问题大小取决于你的脚本做了什么。</p>
<h2 id="如果不指定退出码会发生什么"><a href="# 如果不指定退出码会发生什么" class="headerlink" title="如果不指定退出码会发生什么"></a>如果不指定退出码会发生什么 </h2><p> 在 Linux 里，任何在命令行中执行的脚本都有退出码。在 Bash 脚本中，如果脚本里没有指定退出码，退出码将会是脚本最后一个命令执行后产生的状态码。为了更好地解释退出码，下面将给出一个脚本来说明。</p>
<p><strong>脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">touch /root/<span class="built_in">test</span></span><br><span class="line"><span class="built_in">echo</span> created file</span><br></pre></td></tr></table></figure>
<p>上面的脚本既会执行 <code>touch</code> 命令也会执行 <code>echo</code> 命令。当我们以非 root 用户执行这个脚本时 touch 命令将会执行失败，理想情况下，当我们执行 touch 命令失败时我们希望通过脚本的退出码来表明有命令执行失败。我们可以通过打印 Bash 的特殊变量 <code>$?</code>  来获取退出码。这个变量将会打印出脚本最后一个命令执行的退出码。</p>
<p><strong>执行输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh </span><br><span class="line">touch: cannot touch <span class="string">'/root/test'</span>: Permission denied</span><br><span class="line">created file</span><br><span class="line">$ <span class="built_in">echo</span> $?</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>你可以看到，当执行 <code>./tmp.sh</code> 后退出码是 <code>0</code> ，而 0 代表脚本执行成功，虽然 touch 命令执行失败了。上面的脚本执行了两个命令：<code>touch</code>、<code>echo</code>。因为我们没有指定退出码所以脚本以最后一个命令执行后的状态码退出。在这个例子中，最后运行的是 <code>echo</code> 命令，这个命令确实执行成功了。</p>
<p><strong>脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">touch /root/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>如果我们去掉脚本中的 <code>echo</code> 命令，我们将看到 <code>touch</code> 命令的退出码。</p>
<p><strong>执行结果</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh </span><br><span class="line">touch: cannot touch <span class="string">'/root/test'</span>: Permission denied</span><br><span class="line">$ <span class="built_in">echo</span> $?</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>你可以看到，因为最后运行的命令是 <code>touch</code> ，所以脚本的退出码正确地反应了脚本的状态：执行失败。</p>
<h2 id="在你的 -Bash- 脚本中使用退出码"><a href="# 在你的 -Bash- 脚本中使用退出码" class="headerlink" title="在你的 Bash 脚本中使用退出码"></a>在你的 Bash 脚本中使用退出码 </h2><p> 当从我们的脚本中去掉 <code>echo</code> 命令后脚本跑通了并且返回了恰当的退出码。当我们想在 <code>touch</code> 命令执行成功执行一个操作，而在执行失败时执行另一个操作会发生什么。比如脚本执行成功时输出至 <code>stdout</code> ，执行失败时输出至 <code>stderr</code> 这种操作。</p>
<h3 id="测试退出码"><a href="# 测试退出码" class="headerlink" title="测试退出码"></a>测试退出码 </h3><p> 前面的代码中，我们使用了特殊变量 <code>$?</code> 来打印脚本的退出码。我们同样可以在脚本中使用它来测试 <code>touch</code> 命令是否执行成功。</p>
<p><strong>脚本</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">touch /root/<span class="built_in">test</span> <span class="number">2</span>&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [$? <span class="operator">-eq</span> <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Successfully created file"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Could not create file"</span> &gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p>在上面的修改版代码中，如果 <code>touch</code> 的退出码是 <code>0</code> ，脚本将会输出成功的消息。如果退出码是除 0 以外的其他数字，这表示执行失败，脚本将会打印失败的消息到 <code>stderr</code> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh</span><br><span class="line">Could not create file</span><br></pre></td></tr></table></figure>
<h3 id="在程序中提供你自己的退出码"><a href="# 在程序中提供你自己的退出码" class="headerlink" title="在程序中提供你自己的退出码"></a>在程序中提供你自己的退出码 </h3><p> 在上面的程序中，虽然 <code>touch</code> 命令执行失败时将会提供一个错误信息提示，但它仍给出了表示执行成功的状态码 0 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh</span><br><span class="line">Could not create file</span><br><span class="line">$ <span class="built_in">echo</span> $?</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>既然脚本执行失败了，但它仍然传递执行成功的退出码给其他需要执行此脚本程序显然很不适合。为添加我们自己的退出码到这个程序里，我们可以简单地通过 <code>exit</code> 来实现。</p>
<p><strong>脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">touch /root/<span class="built_in">test</span> <span class="number">2</span>&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [$? <span class="operator">-eq</span> <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Successfully created file"</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Could not create file"</span> &gt;&amp;<span class="number">2</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>通过脚本里的 <code>exit</code> 命令，我们可以在 <code>touch</code> 命令执行成功时输出成功的消息并返回状态码 0 。当 <code>touch</code> 执行失败时我们将打印失败的消息至 <code>stderr</code> 并返回一个表示失败的状态码 1 。</p>
<p><strong>执行结果</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh</span><br><span class="line">Could not create file</span><br><span class="line">$ <span class="built_in">echo</span> $?</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="在命令行中使用退出码"><a href="# 在命令行中使用退出码" class="headerlink" title="在命令行中使用退出码"></a>在命令行中使用退出码 </h3><p> 现在我们的脚本既可以通知用户也能通知程序命令是否执行成功，我们可以使用这个脚本配合其他的管理工具，或者简单地通过 Bash 单行命令使用它。<br><strong>Bash One Liner:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./tmp.sh &amp;&amp; <span class="built_in">echo</span> <span class="string">"bam"</span> || (sudo ./tmp.sh &amp;&amp; <span class="built_in">echo</span> <span class="string">"bam"</span> || <span class="built_in">echo</span> <span class="string">"fail"</span>)</span><br><span class="line">Could not create file</span><br><span class="line">Successfully created file</span><br><span class="line">bam</span><br></pre></td></tr></table></figure></p>
<p>上面的命令组使用了在 Bash 里称为 <strong>list constructs</strong> 的工具。它允许你通过 <code>&amp;&amp;</code>（代表 <strong>and</strong>） 和 <code>||</code> (代表 <strong>or</strong>） 将命令串到一起。上面的命令将会执行 <code>./tmp.sh</code> 脚本，如果退出码是 0 命令 <code>echo &quot;bam&quot;</code> 将被执行。但如果 <code>./tmp.sh</code> 的退出码为 1 ，圆括号里的命令将在之后被执行。圆括号里的命令通过 <code>&amp;&amp;</code> 、 <code>||</code> 被串到一起。</p>
<p>list constructs 使用退出码来知晓一个命令是否执行成功。如果脚本不恰当地使用退出码，其他使用更高阶的命令（比如 list constructs）调用此脚本的用户就可能得到与预期不符的结果。</p>
<h2 id="更多关于退出码的信息"><a href="# 更多关于退出码的信息" class="headerlink" title="更多关于退出码的信息"></a>更多关于退出码的信息 </h2><p>Bash 里的 <code>exit</code> 命令接受不了从 <code>0 - 255</code> 的整形数值，大多数情况下 <code>0</code> 和 <code>1</code> 就够用了，不过其他的数值也提供了，为更具体的错误信息做储备。The Linux Documentation Project 有一个不错的 <a href="http://www.tldp.org/LDP/abs/html/exitcodes.html" target="_blank" rel="external"> 保留状态码</a> 列表，告诉大家这些状态码作何使用。</p>
<hr>
<p>原文链接：<a href="http://bencane.com/2014/09/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/" target="_blank" rel="external">http://bencane.com/2014/09/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/" data-id="ciozl529g000a896vpr1nwr3c" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/">bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exit-code/">exit code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-using-json-viewer-for-debugging" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/using-json-viewer-for-debugging/" class="article-date">
  <time datetime="2016-01-23T11:05:50.000Z" itemprop="datePublished">2016-01-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/using-json-viewer-for-debugging/">使用 Chrome 扩展程序 JSON Viewer 进行调试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>PHP 调试时有很多种方法，其中最简单的无非是 echo 与 var_dump 、 print_r 以及 debug_backtrace 了。这篇文章要介绍的是平常用的比较多的，适合在调 HTTP 接口以及平常开发中需要输出变量内容的情况。其实在 IDE 中比较适合使用 XDebug 或者断点调试，这样能在运行时直接查看当前上下文的各个变量，不过这种情况不在此篇讨论之列，后续我也将介绍相关的方法，来完善这个系列。</p>
<p> 现在步入正题。在平常和前端的配合中经常会有一些 RESTful 接口输出，而其中最常用的内容传输格式就是 JSON ，JSON 在 PHP 中可以很方便地转化为对象或者数组，在打印变量时使用 JSON 再配合浏览器的扩展进行解析，无疑能提高开发效率。</p>
<h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><p> 先用两张图来了解一下 JSON 的格式，这样就不会混淆其在 PHP 中所代表的意思。</p>
<blockquote>
<p> 对象是一个无序的“‘名称 / 值’对”集合。一个对象以“{”（左括号）开始，“}”（右括号）结束。每个“名称”后跟一个“:”（冒号）；“‘名称 / 值’ 对”之间使用“,”（逗号）分隔。</p>
</blockquote>
<p><img src="http://www.json.org/object.gif" alt=""></p>
<blockquote>
<p> 数组是值（value）的有序集合。一个数组以“[”（左中括号）开始，“]”（右中括号）结束。值之间使用“,”（逗号）分隔。</p>
</blockquote>
<p><img src="http://www.json.org/array.gif" alt=""></p>
<blockquote>
<p> 值（value）可以是双引号括起来的字符串（string）、数值 (number)、true、false、 null、对象（object）或者数组（array）。这些结构可以嵌套。</p>
</blockquote>
<p><img src="http://www.json.org/value.gif" alt=""></p>
<h1 id="Chrome- 扩展"><a href="#Chrome- 扩展" class="headerlink" title="Chrome 扩展"></a>Chrome 扩展 </h1><p>JSON viewer 扩展的地址是 <a href="https://chrome.google.com/webstore/detail/json-viewer/gbmdgpbipfallnflgajpaliibnhdgobh" target="_blank" rel="external">https://chrome.google.com/webstore/detail/json-viewer/gbmdgpbipfallnflgajpaliibnhdgobh</a> </p>
<p>JSON view GitHub 官网介绍了其有如下 feature</p>
<ul>
<li> 语法高亮 </li>
<li>23 个内置的主题 </li>
<li> 节点可折叠 </li>
<li> 可点击的 url</li>
<li> 在控制台「console」输入 json 回车中查看你的 JSON （通过访问 id 为 json 的 HTML 元素）</li>
<li> 显示行号选项 </li>
<li> 在 url 中加入时间戳 header</li>
</ul>
<p> 等等。</p>
<h1 id="PHP- 配合 -JSON-viewer- 进行输出调试"><a href="#PHP- 配合 -JSON-viewer- 进行输出调试" class="headerlink" title="PHP 配合 JSON viewer 进行输出调试"></a>PHP 配合 JSON viewer 进行输出调试 </h1><p>PHP 中用来处理 JSON 使用最多的是 json_encode 和 json_decode ，比如你有 array 有如下结构 <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'key1'</span>  =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="number">1</span>       =&gt; <span class="string">'string'</span>,</span><br><span class="line">            <span class="string">'array'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'value1'</span>,</span><br><span class="line">                <span class="string">'value2'</span>,</span><br><span class="line">            )</span><br><span class="line">        );</span><br></pre></td></tr></table></figure></p>
<p> 如果使用 var_dump 输出，那么长的是这样 <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [key1] =&gt; <span class="number">1</span></span><br><span class="line">    [<span class="number">1</span>] =&gt; string</span><br><span class="line">    [<span class="keyword">array</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="number">0</span>] =&gt; value1</span><br><span class="line">            [<span class="number">1</span>] =&gt; value2</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p> 当层级不够多，数组元素不够多，肉眼观察根本不是问题，但是一旦数据变得复杂，输出将会非常难看且不易查找，这时候一个美观的输出外带查看层级和数据复制功能会显得很方便，此时，你只需要 <code>echo json_encode($arr);exit;</code> ，扩展会自动解析 JSON 。</p>
<p> 最终你得到的可能是这样的 UI：</p>
<p><img src="https://raw.githubusercontent.com/tulios/json-viewer/master/screenshot.png" alt=""></p>
<p> 好了，其实还有很多输出调试工具，比如 symfony 的 <a href="https://github.com/symfony/var-dumper" target="_blank" rel="external">var-dumper</a> 既能输出 HTML 的调试信息，又能在 cli 下输出带格式的调试信息。还有 debug helper <a href="https://github.com/raveren/kint/" target="_blank" rel="external">Kint</a> 、Yii 的 <a href="https://github.com/malyshev/yii-debug-toolbar" target="_blank" rel="external">yii-debug-toolbar</a> 以及强大的 XDebug 。</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jayxhj.com/2016/01/using-json-viewer-for-debugging/" data-id="ciozl529c0007896vxhm3mg2o" class="article-share-link">Share</a>
      
        <a href="http://blog.jayxhj.com/2016/01/using-json-viewer-for-debugging/#disqus_thread" class="article-comment-link">留言</a>
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/post-array-data-in-php-curl/">PHP 发起 curl POST 请求时传递数组</a>
          </li>
        
          <li>
            <a href="/2016/05/jayxhjs-chrome-extensions/">常用 Chrome 扩展介绍及使用</a>
          </li>
        
          <li>
            <a href="/2016/05/basic-composer-package-development/">动手开发自己的第一个 composer 包</a>
          </li>
        
          <li>
            <a href="/2016/04/get-week-number-in-month-from-date-in-php/">获取当前日期在本月的第几周</a>
          </li>
        
          <li>
            <a href="/2016/04/lumen-tricks/">Lumen 常用开发技巧</a>
          </li>
        
          <li>
            <a href="/2016/03/setting-timezones-in-lumen/">在 lumen 中设置日期与数据库时区</a>
          </li>
        
          <li>
            <a href="/2016/03/single-double-quote-and-backtick/">反引号 (`)  与 单引号 (&#39;) 以及 双引号 (&#39;&#39;) 的使用</a>
          </li>
        
          <li>
            <a href="/2016/03/fix-headers-already-sent-error-in-php/">解决 PHP &quot;headers already sent&quot; 错误</a>
          </li>
        
          <li>
            <a href="/2016/02/understanding-exit-codes-and-how-to-use-them-in-bash-scripts/">理解 Exit Code 并学会如何在 Bash 脚本中使用</a>
          </li>
        
          <li>
            <a href="/2016/01/using-json-viewer-for-debugging/">使用 Chrome 扩展程序 JSON Viewer 进行调试</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/aop/" style="font-size: 13.33px;">AOP</a> <a href="/tags/annotation/" style="font-size: 10px;">Annotation</a> <a href="/tags/apache/" style="font-size: 10px;">Apache</a> <a href="/tags/aspectj/" style="font-size: 10px;">Aspectj</a> <a href="/tags/dao，action，service/" style="font-size: 10px;">DAO，ACTION，SERVICE</a> <a href="/tags/git/" style="font-size: 10px;">Git</a> <a href="/tags/http/" style="font-size: 10px;">HTTP</a> <a href="/tags/hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/master/" style="font-size: 10px;">Master</a> <a href="/tags/mysql/" style="font-size: 16.67px;">MySQL</a> <a href="/tags/oracle/" style="font-size: 13.33px;">Oracle</a> <a href="/tags/php/" style="font-size: 20px;">PHP</a> <a href="/tags/php5-5/" style="font-size: 10px;">PHP5.5</a> <a href="/tags/sqlexception/" style="font-size: 10px;">SQLException</a> <a href="/tags/slave/" style="font-size: 10px;">Slave</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/composer/" style="font-size: 10px;">composer</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/email/" style="font-size: 10px;">email</a> <a href="/tags/exit-code/" style="font-size: 10px;">exit code</a> <a href="/tags/extensions/" style="font-size: 10px;">extensions</a> <a href="/tags/google搜索技巧/" style="font-size: 10px;">google搜索技巧</a> <a href="/tags/header/" style="font-size: 10px;">header()</a> <a href="/tags/index/" style="font-size: 10px;">index</a> <a href="/tags/instantclient/" style="font-size: 10px;">instantclient</a> <a href="/tags/jsp路径/" style="font-size: 10px;">jsp路径</a> <a href="/tags/laravel/" style="font-size: 10px;">laravel</a> <a href="/tags/lumen/" style="font-size: 13.33px;">lumen</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mb-strcut/" style="font-size: 10px;">mb_strcut()</a> <a href="/tags/mb-substr/" style="font-size: 10px;">mb_substr()</a> <a href="/tags/php/" style="font-size: 16.67px;">php</a> <a href="/tags/quote/" style="font-size: 10px;">quote</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/timezone/" style="font-size: 10px;">timezone</a> <a href="/tags/tips/" style="font-size: 10px;">tips</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/技能/" style="font-size: 10px;">技能</a> <a href="/tags/无法转化为内部格式/" style="font-size: 10px;">无法转化为内部格式</a> <a href="/tags/术语/" style="font-size: 10px;">术语</a> <a href="/tags/杏林地儿/" style="font-size: 10px;">杏林地儿</a> <a href="/tags/核心价值/" style="font-size: 10px;">核心价值</a> <a href="/tags/求职/" style="font-size: 13.33px;">求职</a> <a href="/tags/网页跳转/" style="font-size: 10px;">网页跳转</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">2016 年 06 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">2016 年 05 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">2016 年 04 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">2016 年 03 月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">2016 年 02 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016 年 01 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">2015 年 12 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">2015 年 09 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">2014 年 08 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">2014 年 07 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">2014 年 05 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">2014 年 03 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">2013 年 11 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">2013 年 09 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">2013 年 08 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">2013 年 05 月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">2013 年 04 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">2013 年 03 月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">2013 年 02 月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">2013 年 01 月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">2012 年 12 月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">2012 年 11 月</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">朋友们</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://ceix.me/" target="_blank">顺流而下，把梦做完。</a>
          </li>
        
          <li>
            <a href="http://likangjun.com/" target="_blank">嗨军</a>
          </li>
        
          <li>
            <a href="http://www.ecli2h.net/" target="_blank">张辉 | Ecli2h</a>
          </li>
        
          <li>
            <a href="http://www.aishan100.com/" target="_blank">艾山 | S &amp; J</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 jayxhj<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">历史文章</a>
  
    <a href="https://github.com/jayxhj" class="mobile-nav-link">GitHub</a>
  
</nav>
    
<script>
  var disqus_shortname = 'githubiojayxhj';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="http://apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript">
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"));
    }
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>